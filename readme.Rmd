---
title: tradeR
date: "Last update: `r Sys.time()` in `r Sys.timezone()`"
output:
  html_document:
    code_folding: "hide"
    theme: sandstone
    highlight: zenburn
---
[![Build Status](https://travis-ci.org/deanturpin/tradeR.svg?branch=master)](https://travis-ci.org/deanturpin/tradeR)

# Linear regression
```{r}
# Read JSON files and extract the prices
library("rjson")

# Read any files on disk
files <- list.files(path = "tmp", pattern = "*.json", full.names = TRUE)
stopifnot(length(files) > 0)

# Extract the interesting bits
extract <- function(f){
  json <- fromJSON(file = f)
  sapply(json$Data, function(x) x$open)
}

# Extract all series
prices <-as.data.frame(sapply(files, extract))

# Only process a subset
prices <- prices[c("tmp/BTC.json", "tmp/ETH.json", "tmp/XRP.json")]

# Add a random series
random_prices <- cumsum(rnorm(nrow(prices)))
prices <- cbind(prices, random_prices)
```

```{r}
library("pracma")

# Plot prices and linear regression
linear_regression <- function(name) {

  # Get prices for token  
  y <- unlist(prices[name])
  x <- 1:length(y)

  # Fit line
  relation <- lm(y ~ x)

  # Create plot titles
  main_title <- sub("tmp/", "", sub(".json", "", name))
  sub_title <- paste("sd/var/cov/cor min/mean/max\n", sd(y), var(y), cov(x, y), cor(x, y),
                     "\n", min(y), mean(y), max(y))

  # Plot with calculated line
  plot(x, y, col = "navy", main = main_title, sub = sub_title, 
       abline(relation),
       xlab = "", ylab = "USD")

  grid(10, 10)

  # Plot peaks
  peaks <- findpeaks(y, npeaks = 4, threshold=4, sortstr=TRUE)
  points(peaks[,2], peaks[,1], pch=20, col="maroon")

  # Density
  d <-density(y)
  plot(d, main = paste("density", main_title))

  # Histogram of diffs
  h <- diff(y)
  hist(h, breaks=500, main = past("hist", main_title), sub = paste("std dev", sd(h)))
}

plots <- lapply(colnames(prices), linear_regression)
```

# Normalise
```{r}
normalise <- function(y) {
  low <- min(y)
  high <- max(y)
  y <- y - low
  y <- y / (high - low)
}

normalised <- sapply(prices, normalise)

matplot(normalised, pch = 1)
```
